> 弄清楚老师上课讲的查询 以及不同查询语句的应用场景
>
> 不同查询语句之间的关系是什么
>
> 感觉老师上课讲实验讲的一些查询语句非常僵硬
>
> 计划阅读数据库系统概念第十二章内容
>
> 就是不知道老师上课讲的这些东西在工作中到底是怎么被用的
>
> 工作上对数据库的应用还不是简单给个题目让自己实验的 数据库查询这部分内容只是中间的一个非常小的环节

![image-20230404122516289](第七周 数据库之作业记录.assets/image-20230404122516289.png)



> 具体描述老师给的实验材料的特点 缺点优点都要有 方便自己进行利用
>
> 数据库老师给的实验题目例子的语法是很孤立的, 一个select语句的语法组成在官方文档中是将所有都放在一起了, 就算是王珊那本书也存在类似的问题, 自己老师讲语法存在的问题只是更严重一些
>
> 上述做法很容易导致自己不知道语法的整体框架, 甚至对语法自身所属类别也说不清楚, 比如`ifnull() 是函数, 是一个control flow function` 类似的这种对下列给出的这些操作进行描述
>
> 优点是, 例子很多, 用来辅助理解语法作用很方便, 官方文档是英文也有例子, 但是自己目前的英文能力还是离不开中文拐杖 

> 窗口函数
>
> 排名|序号函数
>
> 聚集函数 + 分窗
>
> SUM([DISTINCT] expr) [over_clause]
>
> Returns the sum of expr. If the return set has no rows, SUM() returns NULL. The DISTINCT keyword can be used to sum only the distinct values of expr.
>
> If there are no matching rows, SUM() returns NULL.
>
> This function executes as a window function if over_clause is present. over_clause is as described in Section 12.21.2, “Window Function Concepts and Syntax”; it cannot be used with DISTINCT.
>
> 
>
> 分布函数 `cume_dist()`
>
> 前后函数 `lag` `lead`
>
> 上卷 `with rollup`



> 查询小于等于当前薪资（salary）的比例, 对于这种类型的查询, 如果不使用分布函数, 应该如何写其查询语句, 并给出具体的mysql代码

可以使用COUNT()和WHERE子句来计算小于等于当前薪资的比例。假设薪资信息存储在名为"salary_table"的表中，可以使用以下MySQL代码进行查询：

```sql
SELECT COUNT(*) / (SELECT COUNT(*) FROM salary_table) AS ratio
FROM salary_table
WHERE salary <= [当前薪资];
```

其中，COUNT(*)是统计满足条件的行数，SELECT COUNT(*) FROM salary_table是计算表中所有行数，两者相除即为小于等于当前薪资的比例。

将代码中的"[当前薪资]"替换为实际的薪资数值即可进行查询。

注意：如果表中存在重复的薪资数值，这些行也会被计算在内，因此可能会出现比例大于1的情况。为了避免这种情况，可以在COUNT()函数中使用DISTINCT关键字，只计算不同的薪资数值的行数。

```sql
SELECT COUNT(DISTINCT salary) / (SELECT COUNT(*) FROM salary_table) AS ratio
FROM salary_table
WHERE salary <= [当前薪资];
```

同样地，将代码中的"[当前薪资]"替换为实际的薪资数值即可进行查询。

> 如果当前薪资是表格中的每一个数的话 应该如何写

如果要计算当前薪资是表格中每一个数的情况下，小于等于当前薪资的比例，可以使用子查询来动态获取当前薪资，并将其与每一行的薪资进行比较。可以使用以下MySQL代码进行查询：

```sql
SELECT COUNT(*) / (SELECT COUNT(*) FROM salary_table) AS ratio
FROM salary_table
WHERE salary <= (SELECT salary FROM salary_table WHERE [条件]);
```

其中，"[条件]"需要替换为动态获取当前薪资的条件，例如可以使用MIN()函数来获取最小的薪资值：

```sql
SELECT COUNT(*) / (SELECT COUNT(*) FROM salary_table) AS ratio
FROM salary_table
WHERE salary <= (SELECT MIN(salary) FROM salary_table);
```

这将计算小于等于表格中最小薪资的比例。如果要计算小于等于表格中每个数的比例，可以使用循环语句来依次查询每个数的比例，例如使用WHILE循环和游标来依次查询每个薪资值的比例。但是这样做效率较低，因为需要执行多个查询语句。

> 能给出循环语句的实现代码吗

是的，如果需要计算小于等于表格中每个数的比例，可以使用循环语句来实现。以下是使用WHILE循环和游标来计算每个薪资值的比例的MySQL代码示例：

```sql
-- 创建临时表格来存储结果
CREATE TEMPORARY TABLE temp_ratio (
  salary INT,
  ratio FLOAT
);

-- 定义游标并查询每个薪资值的比例
DECLARE done INT DEFAULT FALSE;
DECLARE cur_salary INT;
DECLARE cur_ratio FLOAT;
DECLARE cur CURSOR FOR SELECT DISTINCT salary FROM salary_table;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
OPEN cur;

read_loop: LOOP
  FETCH cur INTO cur_salary;
  IF done THEN
    LEAVE read_loop;
  END IF;

  -- 计算小于等于当前薪资的比例
  SET cur_ratio = (SELECT COUNT(*) FROM salary_table WHERE salary <= cur_salary) / (SELECT COUNT(*) FROM salary_table);

  -- 将结果插入临时表格中
  INSERT INTO temp_ratio (salary, ratio) VALUES (cur_salary, cur_ratio);
END LOOP;

CLOSE cur;

-- 查询临时表格中的结果
SELECT * FROM temp_ratio;

-- 删除临时表格
DROP TABLE temp_ratio;
```

这段代码首先创建一个临时表格"temp_ratio"来存储每个薪资值的比例。然后定义一个游标"cur"来遍历每个薪资值，使用循环语句来依次查询每个薪资值的比例，并将结果插入到临时表格中。最后查询临时表格中的结果，并删除临时表格。需要注意的是，这种方法可能会导致性能问题，因为需要执行多个查询语句。



> mysql from子句的写法规范是什么

```mysql
-- 前后函数 lag lead
-- Examp_1：查询前 1 名教师的工资和当前教师工资的差值
select salary -  r1 as subtraction from 
	(SELECT id, dept_name, salary,
	lag(salary,1) over(ORDER BY salary) AS r1
	FROM instructor) as t;
```



帮我修改一下这段mysql 



```
vbnetCopy codeSELECT salary - r1 AS subtraction 
FROM (
    SELECT id, dept_name, salary, 
    LAG(salary, 1) OVER (ORDER BY salary) AS r1
    FROM instructor
) AS t;
```

这个查询的目的是计算每个教员的工资与其前一个教员工资之间的差距。通过使用窗口函数 `LAG()`，我们可以轻松地在查询中获得前一个记录的 `salary` 值。然后，我们可以将当前记录的 `salary` 减去前一个记录的 `salary`，以获得它们之间的差值，并将其命名为 `subtraction`。

我将原查询包装在了一个子查询中，并为子查询创建了别名 `t`。这个子查询返回了所有教员的 `id`、`dept_name`、`salary` 和前一个教员的工资 `r1`，以便我们在外部查询中使用它们。



> from子句的部分范式

```
<from_clause> ::= FROM <table_reference_list>
<table_reference_list> ::= <table_reference> [, <table_reference> ...]
<table_reference> ::= <table_factor> [<join_clause>]
<join_clause> ::= <join_type> JOIN <table_reference> ON <join_condition>
<join_type> ::= INNER | LEFT [OUTER] | RIGHT [OUTER] | FULL [OUTER]
<join_condition> ::= <search_condition>
<table_factor> ::= <table_name> | <derived_table> | <joined_table> | <table_subquery>
```



> 官方文档中找不到EBNF范式的内容





> select子句的范式表达

```
<sql_stmt>  ::=  <select_stmt>
<select_stmt> ::=  SELECT <select_list> FROM <table_references> [WHERE <where_condition>] [GROUP BY <group_by_cols>] [HAVING <having_condition>] [ORDER BY <order_by_cols>] [LIMIT <limit_number>]
<select_list> ::=  <select_list_elem> | <select_list_elem> , <select_list>
<select_list_elem> ::=  <column_name> | <expr> [AS <alias>]
<table_references> ::=  <table_reference> | <table_reference> , <table_references>
<table_reference> ::=  <table_name> | <subquery> [AS] <table_alias> | <table_name> [AS] <table_alias> [<index_hint_list>]
<index_hint_list> ::=  <index_hint> | <index_hint> <index_hint_list>
<index_hint> ::=  USE {INDEX|KEY} [<index_list>]
<index_list> ::=  <index_name> | <index_name> , <index_list>
<where_condition> ::=  <expr>
<group_by_cols> ::=  <column_name> | <expr>
<having_condition> ::=  <expr>
<order_by_cols> ::=  <column_name> [ASC|DESC] | <expr> [ASC|DESC]
<limit_number> ::=  <number> | <number>, <number>
```



> 不同语言自己需要重点关注的内容是什么
> 编程语言类型的 如c++ python 关注控制流程如循环选择函数调用能辅助自己快速阅读代码防止陷入语法细节
> 对于mysql这种语言自己要实现(不陷入语法细节的目标的话)应该重点关注哪些内容呢





> mysql between and的语法范式是什么

以下是 MySQL BETWEEN AND 运算符的 EBNF 范式：

```
goCopy code
comparison_expression ::= scalar_expression [ NOT ] BETWEEN scalar_expression AND scalar_expression
```

其中，`scalar_expression` 表示一个标量表达式，可以是列名、常量、函数等；`NOT` 是可选的关键字，表示取反；`BETWEEN` 和 `AND` 是操作符，用于指定比较的范围。

> MySQL 日期运算的语法范式是什么

MySQL 日期运算的语法范式是什么

MySQL 日期运算的语法范式如下：

```
bashCopy code
DATE_ADD(date, INTERVAL expr unit)
```

其中，`date` 是日期，`expr` 是一个整数表达式，`unit` 是时间单位。此语法范式表示在 `date` 上加上 `expr` 个时间单位，返回计算后的日期。

例如，假设 `date` 是一个日期类型的变量，表示今天的日期，我们想要得到明天的日期，可以使用以下语句：

```
sqlCopy code
SELECT DATE_ADD(date, INTERVAL 1 DAY);
```

其中，`DAY` 表示时间单位为一天。如果要得到昨天的日期，可以使用以下语句：

```
sqlCopy code
SELECT DATE_ADD(date, INTERVAL -1 DAY);
```

这里将 `expr` 取负数，表示减去一天。

除了 `DAY`，MySQL 还支持其他的时间单位，包括 `SECOND`、`MINUTE`、`HOUR`、`WEEK`、`MONTH` 和 `YEAR`。可以根据需要选择相应的时间单位进行日期运算。



![img](data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2730%27%20height=%2730%27/%3e)![Yingxin Qin](https://chat.openai.com/_next/image?url=https%3A%2F%2Flh3.googleusercontent.com%2Fa%2FAGNmyxYeqQVDlbiQ5JJKVNijoB2djmUdZ3CYEFnDeJah%3Ds96-c&w=64&q=75)



对应的EBNF范式是什么呢







以下是 MySQL 日期运算语法的 EBNF 范式：

```
goCopy code<date_add_function> ::= "DATE_ADD" "(" <date_expression> "," "INTERVAL" <expr> <time_unit> ")"
<date_expression> ::= <column> | <date_value_expression>
<column> ::= <identifier>
<date_value_expression> ::= <date_literal> | <date_function>
<date_literal> ::= "DATE" "'" <date_string> "'"
<date_string> ::= <year_value> "-" <month_value> "-" <day_value>
<year_value> ::= <digit> <digit> <digit> <digit>
<month_value> ::= <digit> <digit>
<day_value> ::= <digit> <digit>
<date_function> ::= "CURRENT_DATE" | "NOW()"
<expr> ::= <digit>+
<time_unit> ::= "MICROSECOND" | "SECOND" | "MINUTE" | "HOUR" | "DAY" | "WEEK" | "MONTH" | "QUARTER" | "YEAR"
<digit> ::= "0" | "1" | ... | "9"
<identifier> ::= <alpha> (<alpha> | <digit> | "_")*
<alpha> ::= "a" | "b" | ... | "z" | "A" | "B" | ... | "Z"
```

其中，`<date_add_function>` 表示日期加法函数，其中 `<date_expression>` 表示一个日期表达式，可以是一个列名或者一个日期值表达式；`<date_value_expression>` 表示一个日期值表达式，可以是一个日期字面量或者一个日期函数；`<expr>` 表示一个整数表达式，用于指定日期加上的时间单位数量；`<time_unit>` 表示时间单位，可以是 MICROSECOND、SECOND、MINUTE、HOUR、DAY、WEEK、MONTH、QUARTER 或 YEAR。

注意，在 EBNF 中使用了一些符号，例如 `|` 表示或，`*` 表示重复 0 次或多次，`+` 表示重复 1 次或多次，`()` 表示分组等等。



> 计算机编程中两个日期之间的运算种类有哪些

在计算机编程中，两个日期之间的运算有以下几种：

1. ==相减==：可以通过将两个日期相减来计算它们之间的时间差。结果可以是天数、小时数、分钟数、秒数等等，具体取决于所使用的编程语言和函数。
2. ==比较==：可以使用比较运算符（例如">"、"<"、"="等）来比较两个日期的大小关系，判断它们的先后顺序。
3. ==格式化==：可以将日期格式化为特定的字符串表示形式，例如年-月-日，月/日/年等等。这通常需要使用日期格式化函数或库。
4. ==转换==：可以将日期转换为时间戳或其他日期格式。时间戳是一种表示日期和时间的数字格式，通常以自从1970年1月1日以来的秒数表示。转换可以通过编程语言内置的函数或第三方库来实现。
5. ==增加/减少==：可以增加或减少给定日期的年、月、日、小时、分钟、秒等时间单位。这可以通过使用日期计算函数或库来实现。



MySQL中日期运算的种类如下：

1. 加法运算符（+）：可以将某个日期加上指定的时间间隔。例如，将日期加上一天、一周、一个月等等。
2. 减法运算符（-）：可以计算两个日期之间的时间间隔。例如，计算两个日期之间的天数、小时数、分钟数等等。
3. DATE_ADD()函数：可以将指定的时间间隔加到日期上。例如，将日期加上一天、一周、一个月等等。
4. DATE_SUB()函数：可以从日期中减去指定的时间间隔。例如，从日期中减去一天、一周、一个月等等。
5. DATEDIFF()函数：可以计算两个日期之间的天数差。例如，计算两个日期之间相隔的天数。
6. DATE_FORMAT()函数：可以将日期格式化为指定的格式。例如，将日期格式化为“年-月-日”的格式。
7. EXTRACT()函数：可以从日期中提取指定的部分，例如提取年、月、日等等。

注意：MySQL中日期的运算和处理需要使用 DATE、DATETIME、TIMESTAMP 等日期类型，如果使用字符串类型的日期进行运算和处理可能会导致错误结果。